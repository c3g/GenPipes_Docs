.. _docs_steps_nanopore_covseq:

.. spelling::

      dna
      cfg
      hac
      arrs
      nb 

Step Details
-------------

Following are the various steps that are part of GenPipes Nanopore CoVSeQ genomic analysis pipeline:

.. _Guppy Basecall:

**Guppy Basecall**

This step uses the Oxford Nanopore basecaller, `Guppy`_ to basecall raw FAST5 files and produce FASTQ files. Basecalling model dna_r9.4.1_450bps_hac.cfg is used by default.

.. _Guppy Demultiplex:

**Guppy Demultiplex**

This step uses he Oxford Nanopore basecaller Guppy to demultiplex FASTQ files based on their barcode. Barcode arrangement barcode_arrs_nb96.cfg is used by default.

.. note::

    In the Guppy Demultiplex call, the following parameter, ```--require_barcodes_both_ends```, is set by default.

.. _pycoQC:

**pycoQC**

In this step, `pycoQC Software`_ is used  produce an interactive quality report based on the summary file and alignment outputs. PycoQC relies on the sequencing_summary.txt file generated by Guppy. If needed, it can also generate a summary file from basecalled FAST5 files. PycoQC computes metrics and generates interactive QC plots for Oxford Nanopore technologies sequencing data.

.. _Host Reads Removal:

**Host Reads Removal**

This step uses a mapping approach with a hybrid GRCh38 + SARS-CoV2 genome. The reads that map to the Human Genome are removed from the analysis. A "de-hosted" FASTQ is produced.

.. _Kraken Analysis:

**Kraken Analysis**

`Kraken <http://ccb.jhu.edu/software/kraken/MANUAL.html>`_ is a taxonomic sequence classifier that assigns taxonomic labels to short DNA reads. It does this by examining the k-mers within a read and querying a database with those k-mers.

Additionally, `Kraken2 <https://github.com/DerrickWood/kraken2/blob/master/docs/MANUAL.markdown>`_ is used to produce a report on the raw data, which can be used to detect additional host contamination.

.. _ARTIC Nanopolish:

**ARTIC Nanopolish**

The ARTIC Nanopolish pipeline is used to produce consensus sequences and VCFs. Since Nanopolish is used, this step requires both FAST5 and FASTQ files.

.. _Wub Metrics:

**Wub Metrics**

`Wub Package`_ is used to calculate alignment metrics in this pipeline step.

.. _CoVSeQ Metrics:

**CoVSeQ Metrics**

Using all previous metrics calculated so far, a table is produced with a summary of all metrics for each individual sample.

.. _SnpEff Annotate:

**SnpEff Annotate**

The VCF produced by `ARTIC Nanopolish`_ step is annotated using SnpEff.

.. _Quast Consensus Metrics:

**Quast Consensus Metrics**

Consensus metrics are calculated using the tool `QUAST`_.

.. _Rename Consensus Header:

**Rename Consensus Header**

A final consensus sequence is produced, with the appropriate header and naming convention based on genome completeness.

.. _Prepare Report:

**Prepare Report**

Using `ncov-tools package`_ and additional R scripts, final reports are produced for all samples in the run, including basic QC plots as well as a preliminary lineage assignment through `ncov-tools package`_. 

.. References

.. _pycoQC software: https://github.com/a-slide/pycoQC
.. _QUAST: http://quast.sourceforge.net
.. _ncov-tools package: https://github.com/jts/ncov-tools
